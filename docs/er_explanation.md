# Описание модели базы данных (ERD)

В данном разделе представлена логическая модель базы данных, разработанная для системы прогнозирования закупок. Целью проектирования было создание гибкой, масштабируемой и нормализованной структуры данных, обеспечивающей целостность информации и эффективность аналитических запросов.

## Ключевые сущности и их взаимосвязи:

### 1. Таблица поставщиков (Suppliers)

* **Назначение:** Хранит информацию о компаниях, у которых мы закупаем товары.
* **Структура полей:**
    ```sql
    id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL UNIQUE,
    contact_info TEXT,          -- Общая информация: телефон, email, адрес
    created TIMESTAMPTZ DEFAULT NOW()
    ```

### 2. Таблица складов (Warehouses)

* **Назначение:** Хранит информацию о наших складах.
* **Структура полей:**
    ```sql
    id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL UNIQUE,
    location TEXT,              -- Адрес или описание местоположения
    created_at TIMESTAMPTZ DEFAULT NOW()
    ```

### 3. Таблица товаров (Products)

* **Назначение:** Основной каталог наших товаров.
* **Структура полей:**
    ```sql
    id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    sku VARCHAR(100) NOT NULL UNIQUE,      -- уникальный артикул
    name VARCHAR(255) NOT NULL,
    supplier_id INT NOT NULL,              -- Связь с поставщиком
    weight_kg DECIMAL(10,3) CHECK (weight_kg >= 0),
    created TIMESTAMPTZ DEFAULT NOW()
    ```
* **Связь с таблицей поставщиков:**
    ```sql
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id)
    ```

### 4. Промежуточная таблица остатков (Product Inventory)

* **Назначение:** Реализует связь "многие ко многим" между `Products` и `Warehouses`. Показывает, сколько единиц товара и на каком складе.
* **Структура полей:**
    ```sql
    product_id_pi INT NOT NULL,
    warehouse_id INT NOT NULL,
    quantity INT NOT NULL CHECK (quantity >= 0),     -- Остаток не может быть отрицательным
    last_updated TIMESTAMPTZ DEFAULT NOW()
    ```
* **Составной первичный ключ:**
    ```sql
    PRIMARY KEY (product_id_pi, warehouse_id)
    ```
* **Связи с таблицами товаров и складов:**
    ```sql
    FOREIGN KEY (product_id_pi) REFERENCES products(id),
    FOREIGN KEY (warehouse_id) REFERENCES warehouses(id)
    ```

### 5. Таблица продаж (Sales)

* **Назначение:** Журнал всех операций по продажам.
* **Структура полей:**
    ```sql
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,     -- BIGINT, т.к. продаж может быть очень много
    product_id_s INT NOT NULL,
    sale_date TIMESTAMPTZ NOT NULL,
    quantity INT NOT NULL CHECK (quantity > 0),
    price DECIMAL(10, 2) NOT NULL CHECK (price >= 0),           -- Цена за единицу товара
    total_amount DECIMAL(12, 2) GENERATED ALWAYS AS (quantity * price) STORED -- Вычисляемое поле общей суммы продажи
    ```
* **Связь с таблицей товаров:**
    ```sql
    FOREIGN KEY (product_id_s) REFERENCES products(id)
    ```


## Принципы нормализации и обоснование дизайна:

Модель спроектирована с учётом принципов **нормализации (до 3НФ)**, чтобы:
* **Избежать избыточности данных:** Например, информация о поставщиках хранится в одной таблице и не дублируется в таблице товаров.
* **Обеспечить целостность данных:** Использование внешних ключей (`FOREIGN KEY`) гарантирует, что нельзя добавить продажу для несуществующего товара или товар для несуществующего поставщика.
* **Повысить гибкость:** Отделение сущностей позволяет легко добавлять новые атрибуты или сущности без значительного изменения существующей структуры.

Использование `DECIMAL(10,2)` для цен (`price`, `total_amount`) и `DECIMAL(10,3)` для веса (`weight_kg`) обеспечивает высокую точность расчётов, избегая проблем с плавающей точкой. `JSONB` мог бы быть рассмотрен в таблице `products` для хранения неструктурированных характеристик товара, но для данного проекта было решено ограничиться фиксированным набором колонок для упрощения и ясности.

## Инструменты:

ER-диаграмма была создана с использованием **Draw.io**, а затем реализована в **PostgreSQL**.
